<topology>

    <gateway>

        <provider>
        <role>authentication</role>
        <name>ShiroProvider</name>
        <enabled>true</enabled>
        <param>
            <name>sessionTimeout</name>
            <value>30</value>
        </param>
        <param>
            <name>main.ldapRealm</name>
            <value>org.apache.hadoop.gateway.shirorealm.KnoxLdapRealm</value>
        </param>

        <!-- changes for AD/user sync -->

        <param>
            <name>main.ldapContextFactory</name>
            <value>org.apache.hadoop.gateway.shirorealm.KnoxLdapContextFactory</value>
        </param>

        <!-- main.ldapRealm.contextFactory needs to be placed before other main.ldapRealm.contextFactory* entries  -->
        <param>
            <name>main.ldapRealm.contextFactory</name>
            <value>$ldapContextFactory</value>
        </param>

        <!-- AD url -->
        <param>
            <name>main.ldapRealm.contextFactory.url</name>
            <value>ldap://$ACTIVE_DIRECTORY_HOSTNAME:389</value>
        </param>

        <!-- system user -->
        <param>
            <name>main.ldapRealm.contextFactory.systemUsername</name>
            <value>$AD_USERNAME</value>
        </param>

        <!-- pass in the password using the alias created earlier -->
        <param>
            <name>main.ldapRealm.contextFactory.systemPassword</name>
            <value>$AD_PASSWORD</value>
        </param>

        <param>
            <name>main.ldapRealm.contextFactory.authenticationMechanism</name>
            <value>simple</value>
        </param>
        <param>
            <name>urls./**</name>
            <value>authcBasic</value>
        </param>

        <!--  AD groups of users to allow -->
        <param>
            <name>main.ldapRealm.searchBase</name>
            <value>$AD_BASE</value>
        </param>
        <param>
            <name>main.ldapRealm.userObjectClass</name>
            <value>person</value>
        </param>
        <param>
            <name>main.ldapRealm.userSearchAttributeName</name>
            <value>sAMAccountName</value>
        </param>


        <provider>
            <role>identity-assertion</role>
            <name>Default</name>
            <enabled>true</enabled>
        </provider>

        <provider>
            <role>authorization</role>
            <name>AclsAuthz</name>
            <enabled>true</enabled>
        </provider>

        <provider>
            <role>ha</role>
            <name>HaProvider</name>
            <enabled>true</enabled>
            <param>
                <name>YARNUI</name>
                <value>maxFailoverAttempts=3;failoverSleep=1000;maxRetryAttempts=300;retrySleep=1000;enabled=true
                </value>
            </param>
        </provider>

    </gateway>

    <service>
        <role>NAMENODE</role>
        <url>{{namenode_address}}</url>
        <version>2.7.0</version>
    </service>

    <service>
        <role>JOBHISTORYUI</role>
        <url>http://$HISTORY_SERVER_HOSTNAME:19888</url>
    </service>

    <service>
        <role>HDFSUI</role>
        <version>2.7.0</version>
        <url>http://$NN_HOSTNAME:50070</url>
    </service>

    <service>
        <role>HBASE</role>
        <url>http://$HBASE_HOSTNAME:16010</url>
    </service>

    <service>
        <role>HBASEUI</role>
        <url>http://$HBASE_HOSTNAME:16010</url>
    </service>

    <service>
        <role>JOBTRACKER</role>
        <url>rpc://$RM_HOST:8050</url>
    </service>

    <service>
        <role>WEBHDFS</role>
        <url>http://$NN_HOSTNAME:50070/webhdfs</url>

    </service>


    <service>
        <role>OOZIE</role>
        <url>http://$OOZIE_HOSTNAME:11000/oozie</url>
    </service>

    <service>
        <role>OOZIEUI</role>
        <url>http://$OOZIE_HOSTNAME:11000/oozie/</url>
    </service>


    <service>
        <role>WEBHBASE</role>
        <url>http://$HBASE_HOSTNAME:8080</url>
    </service>

    <service>
        <role>RANGER</role>
        <url>http://$RANGER_HOSTNAME:8888</url>
    </service>

    <service>
        <role>RANGERUI</role>
        <url>http://$RANGER_HOSTNAME:8888</url>
    </service>

    <service>
        <role>HIVE</role>
        <url>http://$HIVE_HOSTNAME:10001/cliservice</url>
    </service>

    <service>
        <role>RESOURCEMANAGER</role>
        <url>http://$RM_HOST:8088/ws</url>
    </service>
    <service>
        <role>YARNUI</role>
        <url>http://$RM_HOST:8088</url>
        <url>http://$RM_HOST:8088</url>
    </service>
    <service>
        <role>YARNUIV2</role>
        <url>http://$RM_HOST:8088</url>
        <url>http://$RM_HOST:8088</url>
    </service>

    <service>
        <role>AMBARIUI</role>
        <url>http://$AMBARI_HOST:8080</url>
    </service>
    <service>
        <role>AMBARI</role>
        <url>http://$AMBARI_HOST:8080</url>
    </service>

</topology>
